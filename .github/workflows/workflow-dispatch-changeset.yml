on:
  workflow_dispatch:
    inputs:
      generate-changelog:
        description: 'Run generation of production changset'
        required: true
        default: 'exit'
        type: choice
        options:
          - exit

jobs:
  generation-changelog-on-trigger:
    runs-on: ubuntu-latest
    if: ${{ startsWith( github.ref, 'refs/heads/v2-release' ) }}
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version-file: '.node-version'
          cache: 'yarn'
      - name: Install dependencies
        run: yarn --immutable
      - name: Change changeset pre based on trigger output
        run: yarn changeset pre exit
        # push commit with file mode for changeset
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Auto merge of ".changeset/pre.json" file
          file_pattern: '.changeset/pre.json'
