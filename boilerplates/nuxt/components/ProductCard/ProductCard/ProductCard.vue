<template>
  <a
    v-focus
    :href="link"
    :aria-label="`Go to ${label}`"
    class="block overflow-hidden border border-gray-200 rounded-md hover:shadow-lg outline-violet"
    :class="{
      'w-[148px]': size === 'xs',
      'w-[180px]': size === 'sm',
      'w-[230px]': size === 'base',
      'w-[280px]': size === 'lg'
    }"
  >
    <slot name="image" v-bind="{image, alt, outOfStock, badge, size}">
      <div class="relative">
        <img
          class="w-full h-auto rounded-md"
          :src="image"
          :alt="alt"
          loading="lazy"
          :width="imageDimensions"
          :height="imageDimensions"
          :class="{
            'opacity-50': outOfStock
          }"
        >
        <slot name="badge">
          <TagBadge
            v-if="badge"
            :size="size === 'lg' || size === 'base' ? 'base' : 'sm'"
            type="info"
            :label="`${badge}`"
            class="absolute top-0 left-0"
          >
            <!-- eslint-disable max-len -->
            <svg
              v-if="size === 'lg' || size === 'base'"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              focusable="false"
            >
              <path d="M11.0679 1.68642C11.0679 0.834202 9.97038 0.513011 9.48698 1.21949C5.05225 7.70169 11.3543 7.99352 11.3543 11.1446C11.3543 12.4204 10.312 13.4527 9.03223 13.4359C7.77288 13.4198 6.771 12.3699 6.771 11.1105V8.04866C6.771 7.27164 5.82318 6.89459 5.2875 7.45784C4.32894 8.46474 3.3335 10.1896 3.3335 12.2904C3.3335 16.0813 6.41758 19.1654 10.2085 19.1654C13.9994 19.1654 17.0835 16.0813 17.0835 12.2904C17.0835 6.19277 11.0679 5.37958 11.0679 1.68642Z" fill="white" />
            </svg>
            <svg
              v-else
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              focusable="false"
            >
              <path
                d="M8.854 1.35148C8.854 0.669706 7.97601 0.412752 7.58929 0.977935C4.0415 6.16369 9.08317 6.39716 9.08317 8.91799C9.08317 9.93864 8.24929 10.7645 7.22549 10.751C6.21801 10.7381 5.4165 9.89825 5.4165 8.89078V6.44127C5.4165 5.81966 4.65825 5.51801 4.22971 5.96861C3.46286 6.77414 2.6665 8.15401 2.6665 9.83466C2.6665 12.8674 5.13377 15.3347 8.1665 15.3347C11.1992 15.3347 13.6665 12.8674 13.6665 9.83466C13.6665 4.95656 8.854 4.30601 8.854 1.35148Z"
                fill="white"
              />
            </svg>
            <!-- eslint-enable max-len -->

          </TagBadge>
        </slot>
        <TagIconLeft
          v-if="inCart > 0 || outOfStock"
          size="sm"
          :type="outOfStock ? 'error' : 'positive'"
          :label="outOfStock ? 'Out of stock' : `${inCart} in cart`"
          class="absolute bottom-0 left-0 m-2"
        >
          <!-- eslint-disable max-len -->
          <svg
            v-if="!outOfStock"
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M1.33329 1.33203C0.965103 1.33203 0.666626 1.63051 0.666626 1.9987C0.666626 2.36689 0.965103 2.66536 1.33329 2.66536H2.87111C3.02633 2.66536 3.16101 2.7725 3.19591 2.92374L4.83815 10.0401C5.01266 10.7963 5.68604 11.332 6.46214 11.332H11.8858C12.6506 11.332 13.3173 10.8115 13.5028 10.0696L14.6694 5.40292C14.9324 4.35101 14.1368 3.33203 13.0525 3.33203H4.65851L4.4951 2.62393C4.32059 1.86771 3.64721 1.33203 2.87111 1.33203H1.33329ZM8.41815 9.70082C8.54959 9.84336 8.72699 9.92187 8.91107 9.92187L8.92415 9.92188C9.1149 9.92188 9.29898 9.82946 9.42375 9.67969L12.5127 6.03055C12.7756 5.72439 12.7559 5.24663 12.4732 4.9688C12.1909 4.68373 11.7503 4.70517 11.4941 5.01168L8.89129 8.09038L7.64255 6.73629C7.37328 6.44398 6.93297 6.44398 6.6634 6.73629C6.39383 7.02827 6.39383 7.50573 6.6634 7.79804L8.41815 9.70082Z"
              fill="#16A34A"
            />
            <path
              d="M6.46676 14.6654C5.73038 14.6654 5.13342 14.0684 5.13342 13.332C5.13342 12.5957 5.73038 11.9987 6.46676 11.9987C7.20314 11.9987 7.80009 12.5957 7.80009 13.332C7.80009 14.0684 7.20314 14.6654 6.46676 14.6654Z"
              fill="#16A34A"
            />
            <path
              d="M11.8001 14.6654C11.0637 14.6654 10.4668 14.0684 10.4668 13.332C10.4668 12.5957 11.0637 11.9987 11.8001 11.9987C12.5365 11.9987 13.1334 12.5957 13.1334 13.332C13.1334 14.0684 12.5365 14.6654 11.8001 14.6654Z"
              fill="#16A34A"
            />
          </svg>
          <!-- eslint-enable max-len -->

        </TagIconLeft>
      </div>
    </slot>
    <slot name="details" v-bind="{size, maxRatingValue, reviews, ratingValue, label}">
      <div
        class="border-gray-200 border-t-[1px] flex flex-col"
        :class="{
          'p-2': size === 'xs' || size === 'sm',
          'p-4': size === 'base' || size === 'lg'
        }"
      >
        <slot name="top">
          <RatingBase
            :max="maxRatingValue"
            :reviews="reviews"
            :value="ratingValue"
            size="xs"
          />
        </slot>
        <slot name="middle">
          <span
            class="block font-normal font-body"
            :class="[
              size === 'lg' ? 'text-base leading-6' : 'text-sm leading-5',
              {
                'my-1': size === 'xs' || size === 'sm',
                'mt-1 mb-2': size === 'base',
                'mb-1 -order-1': size === 'lg'
              }
            ]"
          >
            {{ label }}
          </span>
        </slot>
        <slot name="description" class="mt-2" v-bind="{description, size, shippingDetails, returnsDetails}">
          <div v-if="description && size === 'lg'" class="mt-2">
            <span class="text-sm font-normal leading-5 text-gray-700 font-body">
              {{ description }}
            </span>
            <ul>
              <li class="flex items-center my-2">
                <!-- eslint-disable max-len -->
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M3.19567 8.32546C3.01885 8.32546 2.8493 8.25523 2.72428 8.13021C2.59924 8.00516 2.529 7.83561 2.529 7.65879V2.81879C2.53676 2.42132 2.69663 2.04195 2.97568 1.7588C3.25848 1.48167 3.63974 1.3282 4.03568 1.33213H6.53031L6.53552 1.33211H9.20218L9.20739 1.33213H11.7157C11.9088 1.32987 12.1004 1.36648 12.279 1.43979C12.4577 1.51309 12.6198 1.62157 12.7557 1.7588C13.0345 2.03668 13.1946 2.41189 13.2023 2.80546V6.33878C13.2023 6.5156 13.1321 6.68518 13.0071 6.8102C12.8821 6.93522 12.7125 7.00545 12.5357 7.00545C12.3589 7.00545 12.1893 6.93522 12.0643 6.8102C11.9392 6.68518 11.869 6.5156 11.869 6.33878V2.81879C11.8654 2.77585 11.8464 2.73563 11.8157 2.70546C11.8112 2.69945 11.8061 2.69399 11.8004 2.68916C11.7958 2.68526 11.7909 2.68176 11.7857 2.67873C11.783 2.67718 11.7802 2.67576 11.7774 2.67446C11.7623 2.66747 11.7456 2.66437 11.729 2.66546H9.86885V4.17878C9.86915 4.33114 9.83927 4.48205 9.7809 4.6228C9.72255 4.76355 9.63688 4.89133 9.52884 4.99878C9.41688 5.11153 9.28244 5.19946 9.13429 5.25689C8.98614 5.31431 8.82755 5.33994 8.66886 5.33211H7.02884C6.72234 5.33211 6.4283 5.21081 6.21095 4.99471C5.9936 4.7786 5.87062 4.48527 5.86885 4.17878V2.66546H4.00233C3.9837 2.66388 3.96496 2.66666 3.9476 2.67361C3.9369 2.67789 3.92691 2.68368 3.91792 2.69076C3.91231 2.69518 3.9071 2.70009 3.90234 2.70546C3.86816 2.74205 3.84706 2.78894 3.84234 2.83879V7.65879C3.84242 7.83219 3.77494 7.9988 3.65421 8.12327C3.53346 8.24774 3.36899 8.32025 3.19567 8.32546ZM7.20218 2.66544H8.53552V3.99878H7.20218V2.66544Z"
                    fill="#71717A"
                  />
                  <path
                    d="M10.6688 11.6321H7.53552C7.24092 11.6317 6.95397 11.5384 6.71551 11.3655C6.57474 11.2668 6.45458 11.1433 6.36041 11.0018L2.90905 10.7921C2.89151 10.7886 2.87373 10.7869 2.85595 10.7869C2.83801 10.7868 2.82006 10.7886 2.80238 10.7921C2.77445 10.8047 2.75113 10.8256 2.73571 10.8521C2.72645 10.8825 2.72645 10.915 2.73571 10.9454C2.72959 10.974 2.72959 11.0035 2.73571 11.0321C2.74403 11.0543 2.75738 11.0743 2.77473 11.0905C2.79209 11.1067 2.81296 11.1187 2.83573 11.1254L8.53572 13.2654C8.75166 13.3401 8.98644 13.3401 9.20239 13.2654L13.569 11.8054C13.737 11.7498 13.9202 11.7631 14.0784 11.8424C14.2365 11.9218 14.3567 12.0608 14.4124 12.2288C14.4681 12.3967 14.4548 12.58 14.3754 12.7381C14.296 12.8963 14.157 13.0164 13.989 13.0721L9.62239 14.5254C9.36854 14.6195 9.09977 14.6669 8.82905 14.6654C8.54756 14.6734 8.2671 14.6281 8.00239 14.5321L2.32238 12.3921C1.96237 12.2602 1.66658 11.9954 1.49572 11.6521C1.37607 11.4126 1.32094 11.1461 1.33573 10.8788C1.35406 10.6111 1.44384 10.3533 1.59572 10.1321C1.74122 9.90692 1.94673 9.72682 2.18906 9.6121C2.43007 9.49078 2.70043 9.43994 2.96905 9.46543L6.27174 9.66107C6.28139 9.64009 6.29154 9.61934 6.30218 9.59879C6.39172 9.42395 6.51657 9.26959 6.66884 9.14546C6.81764 9.02569 6.99043 8.93931 7.17551 8.89213L10.4088 7.9988C10.8434 7.88222 11.2975 7.85726 11.7422 7.92545L13.6688 8.25213C13.8457 8.28131 14.0036 8.37951 14.108 8.52516C14.2124 8.67081 14.2547 8.85199 14.2255 9.02879C14.1963 9.2056 14.0981 9.36358 13.9525 9.46797C13.8068 9.57236 13.6256 9.61464 13.4488 9.58547L11.5222 9.26546C11.2668 9.222 11.005 9.23565 10.7555 9.30546L7.51552 10.1788L7.46884 10.2255L7.53552 10.2988H10.6688C10.8457 10.2988 11.0152 10.369 11.1403 10.4941C11.2653 10.6191 11.3355 10.7887 11.3355 10.9655C11.3355 11.1423 11.2653 11.3118 11.1403 11.4369C11.0152 11.5619 10.8457 11.6321 10.6688 11.6321Z"
                    fill="#71717A"
                  />
                </svg>
                <!-- eslint-enable max-len -->

                <span
                  class="ml-2 text-sm font-normal leading-5 text-gray-700 font-body"
                >
                  {{ shippingDetails }}
                </span>
              </li>
              <li class="flex items-center">
                <!-- eslint-disable max-len -->
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M8.00007 10.668C8.73341 10.668 9.33341 10.068 9.33341 9.33463C9.33341 8.6013 8.73341 8.0013 8.00007 8.0013C7.26674 8.0013 6.66674 8.6013 6.66674 9.33463C6.66674 10.068 7.26674 10.668 8.00007 10.668ZM11.3334 6.0013V4.0013C11.3334 2.1613 9.84007 0.667969 8.00007 0.667969C6.16007 0.667969 4.66674 2.1613 4.66674 4.0013V6.0013C3.38103 6.0013 19.6824 6.0013 11.3334 6.0013ZM5.93341 4.0013C5.93341 2.8613 6.86007 1.93464 8.00007 1.93464C9.14007 1.93464 10.0667 2.8613 10.0667 4.0013V6.0013H5.93341V4.0013Z"
                    fill="#71717A"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M2.66663 6.66797C2.66663 5.93159 3.26358 5.33464 3.99996 5.33464H12C12.7363 5.33464 13.3333 5.93159 13.3333 6.66797V11.5617C13.3333 12.0951 13.0154 12.5771 12.5252 12.7872L8.52518 14.5015C8.18979 14.6453 7.81013 14.6453 7.47473 14.5015L3.47473 12.7872C2.98449 12.5771 2.66663 12.0951 2.66663 11.5617V6.66797ZM4.33329 6.66797C4.1492 6.66797 3.99996 6.81721 3.99996 7.0013V11.3419C3.99996 11.4752 4.07942 11.5958 4.20199 11.6483L7.86865 13.2197C7.9525 13.2557 8.04742 13.2557 8.13127 13.2197L11.7979 11.6483C11.9205 11.5958 12 11.4752 12 11.3419V7.0013C12 6.81721 11.8507 6.66797 11.6666 6.66797H4.33329Z"
                    fill="#71717A"
                  />
                  <path
                    d="M8.00007 10.668C8.73341 10.668 9.33341 10.068 9.33341 9.33463C9.33341 8.6013 8.73341 8.0013 8.00007 8.0013C7.26674 8.0013 6.66674 8.6013 6.66674 9.33463C6.66674 10.068 7.26674 10.668 8.00007 10.668ZM11.3334 6.0013V4.0013C11.3334 2.1613 9.84007 0.667969 8.00007 0.667969C6.16007 0.667969 4.66674 2.1613 4.66674 4.0013V6.0013C3.38103 6.0013 19.6824 6.0013 11.3334 6.0013ZM5.93341 4.0013C5.93341 2.8613 6.86007 1.93464 8.00007 1.93464C9.14007 1.93464 10.0667 2.8613 10.0667 4.0013V6.0013H5.93341V4.0013Z"
                    fill="#71717A"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M2.66663 6.66797C2.66663 5.93159 3.26358 5.33464 3.99996 5.33464H12C12.7363 5.33464 13.3333 5.93159 13.3333 6.66797V11.5617C13.3333 12.0951 13.0154 12.5771 12.5252 12.7872L8.52518 14.5015C8.18979 14.6453 7.81013 14.6453 7.47473 14.5015L3.47473 12.7872C2.98449 12.5771 2.66663 12.0951 2.66663 11.5617V6.66797ZM4.33329 6.66797C4.1492 6.66797 3.99996 6.81721 3.99996 7.0013V11.3419C3.99996 11.4752 4.07942 11.5958 4.20199 11.6483L7.86865 13.2197C7.9525 13.2557 8.04742 13.2557 8.13127 13.2197L11.7979 11.6483C11.9205 11.5958 12 11.4752 12 11.3419V7.0013C12 6.81721 11.8507 6.66797 11.6666 6.66797H4.33329Z"
                    fill="#71717A"
                  />
                </svg>
                <!-- eslint-enable max-len -->

                <span class="ml-2 text-sm font-normal leading-5 text-gray-700 font-body">
                  {{ returnsDetails }}
                </span>
              </li>
            </ul>
          </div>
        </slot>
        <div
          class="flex items-baseline"
          :class="{
            'opacity-40': outOfStock,
            'mt-4': size === 'lg'
          }"
        >
          <slot name="bottom" v-bind="{price, oldPrice, size}">
            <span
              class="font-bold font-headings"
              :class="[
                {
                  'text-lg leading-6': size === 'base' || size === 'lg',
                  'text-xs leading-4': size === 'sm' || size === 'xs'
                },
                oldPrice ? 'text-secondary-700' : 'text-gray-900'
              ]"
            >{{ price }}</span>
            <span
              class="ml-1 text-xs font-normal leading-4 text-gray-500 line-through large:ml-2"
            >
              {{ oldPrice }}
            </span>
          </slot>
        </div>
      </div>
    </slot>
  </a>
</template>

<script>
import { computed } from '@vue/composition-api';
import focus from '../../../utils/focus-directive';

import RatingBase from '../../Rating/RatingBase/RatingBase.vue';
import TagIconLeft from '../../Tag/TagIconLeft/TagIconLeft.vue';
import TagBadge from '../../Tag/TagBadge/TagBadge.vue';

export default {
  name: 'ProductCard',
  components: {
    RatingBase,
    TagIconLeft,
    TagBadge,
  },
  directives: {
    focus,
  },
  props: {
    image: {
      type: String,
      default: '',
    },
    alt: {
      type: String,
      default: '',
    },
    link: {
      type: String,
      default: '/',
    },
    ratingValue: {
      type: Number,
      default: 0,
    },
    maxRatingValue: {
      type: Number,
      default: 5,
    },
    reviews: {
      type: Number,
      default: 0,
    },
    label: {
      type: String,
      default: '',
    },
    price: {
      type: String,
      default: '',
    },
    oldPrice: {
      type: String,
      default: '',
    },
    badge: {
      type: String,
      default: '',
    },
    description: {
      type: String,
      default: '',
    },
    shippingDetails: {
      type: String,
      default: '',
    },
    returnsDetails: {
      type: String,
      default: '',
    },
    outOfStock: {
      type: Boolean,
      default: false,
    },
    inCart: {
      type: Number,
      default: 0,
    },
    size: {
      type: String,
      default: 'base',
      validator(value) {
        return [
          'xs',
          'sm',
          'base',
          'lg',
        ].includes(value);
      },
    },
  },
  setup(props) {
    const imageDimensions = computed(() => {
      switch (props.size) {
        case 'xs':
          return 148;
        case 'sm':
          return 180;
        case 'lg':
          return 280;
        default:
          return 230;
      }
    });

    return {
      imageDimensions,
    };
  },
};
</script>
