<div class="sf-product-card">
  <button
    v-if="wishlistIcon !== false"
    :aria-label="ariaLabel"
    :class="wishlistIconClasses"
    @click="toggleIsOnWishlist"
  >
    <slot name="wishlist-icon" v-bind="{ currentWishlistIcon }">
      <SfIcon
        :icon="currentWishlistIcon"
        color="black"
        size="22px"
        data-test="sf-wishlist-icon"
      />
    </slot>
  </button>
  <component
    :is="linkComponentTag"
    :href="linkComponentTag === 'a' ? link : undefined"
    :to="link && linkComponentTag !== 'a' ? link : undefined"
    class="sf-product-card__link"
  >
    <div ref="productImage" class="sf-product-card__image-wrapper">
      <slot name="image" v-bind="{ image, title }">
        <div v-if="Array.isArray(image)" class="sf-product-card__pictures">
          <SfImage
            v-for="(picture, key) in image.slice(0, 2)"
            :key="key"
            class="sf-product-card__picture"
            :src="picture"
            :alt="title"
            :width="imageWidth"
            :height="imageHeight"
          />
        </div>
        <SfImage
          v-else
          class="sf-product-card__image"
          :src="image"
          :alt="title"
          :width="imageWidth"
          :height="imageHeight"
        />
      </slot>
      <template v-if="showAddToCartButton">
        <slot
          name="add-to-cart"
          v-bind="{ isAddedToCart, showAddedToCartBadge, isAddingToCart }"
        >
          <SfCircleIcon
            class="sf-product-card__add-button"
            aria-label="add-to-cart"
            role="button"
            :has-badge="showAddedToCartBadge"
            :disabled="addToCartDisabled"
            @click="onAddToCart"
          >
            <div class="sf-product-card__add-button--icons">
              <transition
                name="sf-product-card__add-button--icons"
                mode="out-in"
              >
                <slot v-if="!isAddingToCart" name="add-to-cart-icon">
                  <SfIcon
                    key="add_to_cart"
                    icon="add_to_cart"
                    size="20px"
                    color="white"
                  />
                </slot>
                <slot v-else name="adding-to-cart-icon">
                  <SfIcon
                    key="added_to_cart"
                    icon="added_to_cart"
                    size="20px"
                    color="white"
                  />
                </slot>
              </transition>
            </div>
          </SfCircleIcon>
        </slot>
      </template>
    </div>
    <slot name="title" v-bind="{ title }">
      <h3 class="sf-product-card__title">
        {{ title }}
      </h3>
    </slot>
  </component>
  <slot name="price" v-bind="{ specialPrice, regularPrice }">
    <SfPrice
      v-if="regularPrice"
      class="sf-product-card__price"
      :regular="regularPrice"
      :special="specialPrice"
    />
  </slot>
  <slot name="reviews" v-bind="{ maxRating, scoreRating }">
    <div
      v-if="typeof scoreRating === 'number'"
      class="sf-product-card__reviews"
    >
      <SfRating
        class="sf-product-card__rating"
        :max="maxRating"
        :score="scoreRating"
      />
      <a
        v-if="reviewsCount"
        class="sf-product-card__reviews-count"
        href="#"
        @click="$emit('click:reviews')"
      >
        ({{ reviewsCount }})
      </a>
    </div>
  </slot>
</div>
